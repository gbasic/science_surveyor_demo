<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="stylish.css">
	<script type="text/javascript" src="p5/p5.js"></script>
	<style>
		html, body{
			margin: 0;
			padding: 0;
			background: white;
		}
	</style>
</head>
<script type="text/javascript">

	var str;
	var topTextMargin;
	var rectSize;
	var c1;
	var c2;

  var hooverscoreList;
  var articles = [];
  var closest;

  var titleFont;
  var listFont;

  // var rowCount;
  // var articleName = [];
  // var indegreeIN = [];
  // var indegreeOUT = [];
  // var tf_idf = [];
  // var year = [];
  // var isCited = [];


  p5.disableFriendlyErrors = true;

  function preload() {
    titleFont = loadFont('fonts/Rubik-Medium.ttf');
    listFont = loadFont ('fonts/Rubik-Regular.ttf');
    hooverscoreList = loadStrings('methane_outlier_hooverscore.txt');
  }

  function setup() {
    createCanvas(990, 650);

    readData();
    println(articles.length);
    margin = width/30;
    topTextMargin = 3 * margin;
    rectSize = (width - 2 * margin) / 25;
    c1 = color(195, 222, 232);
    c2 = color(10, 177, 209);
    str = "We identified a tantalizing pattern that, if substantiated, might help journalists identify a study as “mainstream” or “outlier.” The latter would suggest a need for greater scrutiny. The Agreement Score indicates whether the new study cites similar ones. Initial research suggests that studies with atypical (perhaps “outlier”) findings have low agreement scores—they cite fewer papers similar to them. Studies with usual (perhaps “consensus-like”) results have high agreement scores—they cite more papers that are similar."
  }

  function draw() {
    background(250);

    fill(0);
    noStroke();
    textAlign(CENTER, CENTER);
    textFont(titleFont);
    textSize(21);
    text("Mainstream or Outlier?", width / 2, margin);

    textFont(listFont);
    textAlign(LEFT, TOP);
    textSize(18);
    text(str, margin, topTextMargin, width - 2 * margin, height - 5 * margin);

  // Hooverscore Rectangle
  rectMode(CENTER);
  stroke(0);
  noFill();
  strokeWeight(2);
  rect(width/2, height/2, 3 * margin, 3 * margin);
  fill(0);
  noStroke();
  textSize(60);
  textFont(listFont);
  textAlign(CENTER, CENTER);
  text("0", width/2, height/2);
  textSize(14);
  text("Agreement Score", width/2, height/2 - 1.9 * margin);

  // Top 25 Bar
  textSize(14);
  textAlign(LEFT, BOTTOM);
  text("Top 25 most similar studies (hover over tiles to display info):", margin, height/2 + 3.7 * margin);

  textAlign(CENTER, CENTER);
  for (var i = 0; i < articles.length; i ++) {
    articles[i].display(margin + i * rectSize, height/2 + 4 * margin);
    fill(0);
    noStroke();
    text(i + 1, margin + i * rectSize + rectSize / 2, height/2 + 4 * margin + rectSize / 2);
  }

  if (closest != null && mouseX > margin && mouseX < width - margin && mouseY > height/2 + 4 * margin && mouseY < height/2 + 4 * margin + rectSize) {
    closest.displayInfo();
  }

  // Legend
  rectMode(CORNER);
  noFill();
  stroke(255, 35, 35);
  rect(margin, height/2 + 7.5 * margin, rectSize, rectSize);
  noStroke();
  fill(255, 35, 35);
  textAlign(LEFT, CENTER);
  text("Cited studies are outlined in red", 2.5 * margin, height/2 + 7.5 * margin + rectSize/2);
}

function readData () {
  // rowCount = hooverscoreTable.getRowCount();
  // articleName = hooverscoreTable.getColumn("title");
  // indegreeIN = hooverscoreTable.getColumn("in degree in context age-tapered");
  // indegreeOUT = hooverscoreTable.getColumn("in degree out of context");
  // tf_idf = hooverscoreTable.getColumn("tf-idf score (-1.0 if it is the article itself)");
  // year = hooverscoreTable.getColumn("year");
  // isCited = hooverscoreTable.getColumn("cited by article (1 if cited, 0 if not, -1 if article itself)");
  for (var i = 1; i < hooverscoreList.length; i++) {
    articles[i-1] = new Article (hooverscoreList[i]);
  }
}

function Article (line) {
  this.infoPieces = split (line, '\t');
  this.articleName = this.infoPieces[6];
  this.indegreeIN = this.infoPieces[1];
  this.indegreOUT = this.infoPieces[3];
  this.tf_idf = this.infoPieces[5];
  this.year = this.infoPieces[7];
  this.isCited = this.infoPieces[8];

  this.display = function (x, y) {
    var d = dist(x + rectSize/2, y + rectSize/2, mouseX, mouseY);
    if (d < rectSize/2 && mouseX > margin && mouseX < width - margin && mouseY > height/2 + 4 * margin && mouseY < height/2 + 4 * margin + rectSize) {
      closest = this;
    }
    if (this.isCited == 1) {
      stroke(255, 35, 35);
    } else {
      stroke(c2);
    }
    if (closest == this && mouseX > margin && mouseX < width - margin && mouseY > height/2 + 4 * margin && mouseY < height/2 + 4 * margin + rectSize) {
      fill(c2);
    } else {
      fill(c1);
    }
    rectMode(CORNER);
    rect(x, y, rectSize, rectSize);
  }

  this.displayInfo = function () {
    noStroke();
    fill(0);
    textSize(14);
    textFont(listFont);
    textAlign(LEFT, CENTER);
    text(this.articleName, margin, height/2 + 6 * margin);
    text("Author names will appear here", margin, height/2 + 6.6 * margin);
  }
}

</script>